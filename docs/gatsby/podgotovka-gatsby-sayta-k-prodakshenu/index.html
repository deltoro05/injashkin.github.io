<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/index.jrg.css">
    <link rel="shortcut icon" href="/favicon.ico">
    <script defer src="/index.js"></script>
    <meta name="description" content="Как подготовить Gatsby сайт к работе. Инструмент диагностики сайта - Lighthouse. Добавление на сайт файла манифеста, офлайн поддержки, метаданных для страниц">
    <title>Руководство по Gatsby. Тестирование и подготовка сайта к публикации | jinv.ru</title>
    <link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml">
    <link rel="apple-touch-icon" sizes="57x57" href="images/icons/apple57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/icons/apple60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/icons/apple72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/icons/apple76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/icons/apple114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/icons/apple120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/icons/apple144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/icons/apple152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/icons/apple180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="images/icons/icon-192.png">
    <link rel="icon" href="/favicon-32.png" type="image/png" sizes="32x32">
    <link rel="icon" href="/favicon-96.png" type="image/png" sizes="96x96">
    <link rel="icon" href="/favicon-16.png" type="image/png" sizes="16x16">
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body>
    <header class="header">
      <div class="header__content content">           
        <div class="header__logo">
          <div class="logo">        <a href="/" title="jinv.ru"> 
              <svg class="icon icon__logo" role="img" width="4em" height="4em">
                <use href="/sprite.svg#logo"></use>
              </svg></a></div>
          <div class="logo-text"> <a href="/" title="jinv.ru">inv.ru</a></div>
          <div class="logo_mobile"><a href="/" title="jinv.ru"><img src="/images/icon-72x72.png" alt="Логотип сайта jinv.ru"/></a></div>
        </div>
        <nav class="menu" aria-label="Главное меню">   
          <div class="content"> 
            <input id="menu__toggle" type="checkbox"/>
            <label class="menu__btn" for="menu__toggle"><span>   </span></label>
            <ul class="menu__box">
              <li><a class="menu__item" href="/">Главная</a></li>
              <li><a class="menu__item" href="/toc.html">Статьи</a></li>
              <li><a class="menu__item" href="/author.html">Об авторе</a></li>
            </ul>
          </div>
        </nav>
        <div class="theme">
          <select id="theme" name="theme">        
            <option value="auto">Авто      </option>
            <option value="light">Светлая      </option>
            <option value="dark">Темная    </option>
          </select>
        </div>
        <div class="header__contacts">
          <div class="send-mes">
            <div class="soc"><a class="mes-em" href="injashkin@gmail.com" title="Email" target="_blank" rel="nofollow">
                <svg class="icon icon__email" role="img" width="1em" height="1em">
                  <use href="/sprite.svg#email"></use>
                </svg></a><a class="mes-tg" href="https://t.me/jashkin" title="Telegram" target="_blank" rel="nofollow">
                <svg class="icon icon__telegram" role="img" width="1em" height="1em">
                  <use href="/sprite.svg#telegram"></use>
                </svg></a><a class="mes-wa" href="https://api.whatsapp.com/send?phone=79183549497" title="WhatsApp" target="_blank" rel="nofollow">
                <svg class="icon icon__whatsapp" role="img" width="1em" height="1em">
                  <use href="/sprite.svg#whatsapp"></use>
                </svg></a>
            </div>
          </div>
          <div class="contacts">         
            <p> <a href="https://github.com/injashkin/injashkin.github.io">Github</a></p>
          </div>
        </div>
      </div>
    </header>
    <div class="content">
      <div class="article">
        <h1>Руководство по Gatsby. Тестирование и подготовка сайта к публикации</h1>
        <div class="creationDate">Создано: 09-02-2020</div><p>Это последняя статья из серии “Руководство по Gatsby”</p>
<p>В предыдущих частях изучалось следующее:</p>
<ul>
<li>создание сайтов Gatsby</li>
<li>создание страниц и компонентов</li>
<li>компоненты стиля</li>
<li>добавление плагинов на сайт</li>
<li>данные source и transform</li>
<li>использование GraphQL для запроса данных</li>
<li>программное создание страниц из данных</li>
</ul>
<p>В этом заключительном разделе показываются общие шаги по подготовке сайта к работе, инструмент диагностики <a href="https://developers.google.com/web/tools/lighthouse/">Lighthouse</a> и плагины, которые часто используются на Gatsby-сайтах.</p>
<h2>Как выполнить тест с помощью Lighthouse</h2>
<p>Lighthouse - автоматизированный инструмент с открытым исходным кодом для улучшения качества веб-страниц. Lighthouse проверяет на веб-страницах производительность, доступность, PWA и др. Lighthouse входит в инструменты разработчика Chrome и позволяет проводить тесты и обнаруживать ошибки. Скорость и доступность сайта увеличатся если устранить эти ошибки и внедрить улучшения, которые предлагает Lighthouse.</p>
<p>Сначала, создайте рабочую сборку Gatsby сайта. Сервер Gatsby оптимизирован для ускорения разработки, но сайт, который создает сервер, хотя и похож на рабочую версию, не оптимизирован как надо.</p>
<h3>Создание рабочей сборки</h3>
<ol>
<li>Остановите сервер разработки если он еще работает и выполните следующую команду:</li>
</ol>
<pre><code class="language-shell">gatsby build
</code></pre>
<p>Эта команда делает рабочую сборку и выводит статические файлы в каталог <code>public</code>.</p>
<ol start="2">
<li>Чтобы просмотреть рабочий сайт локально, выполните:</li>
</ol>
<pre><code class="language-shell">gatsby serve
</code></pre>
<p>После ввода этой команды, перейдите по адресу http://localhost:9000.</p>
<h3>Выполнение теста в Lighthouse</h3>
<ol>
<li>
<p>Откройте сайт с помощью браузера Chrome в режиме Инкогнито, чтобы никакие расширения не мешали тесту. Затем, откройте в Хроме инструменты разработчика DevTools.</p>
</li>
<li>
<p>Нажмите на вкладку “Audits”, где появится экран, который выглядит следующим образом:</p>
</li>
</ol>
<p><img src="lighthouse-audit.png" alt="Запуск теста на Lighthouse"></p>
<ol start="3">
<li>Чтобы выполнить тест нажмите кнопку “Generate report” (по умолчанию выбраны все доступные типы теста). После завершения теста появятся результаты, которые выглядят следующим образом:</li>
</ol>
<p><img src="lighthouse-audit-results.png" alt="Результаты теста Lighthouse"></p>
<p>Из тестов видно, что производительность Gatsby превосходная из коробки, но не хватает некоторых вещей для PWA, Accessibility, Best Practices и SEO, которые улучшат результаты и сделают сайт намного дружелюбнее для посетителей и поисковиков.</p>
<p>Оценка в категории “Progressive Web App” довольно скромная, поэтому, попробуем разобраться с этим.</p>
<p>Progressive Web App или PWA - это веб-сайты, которые похожи на приложения благодаря использованию функционала в современных браузерах. В <a href="https://developers.google.com/web/progressive-web-apps/">обзоре Google</a> освещается, что определяет работу PWA.</p>
<p>Ниже приводятся три <a href="https://alistapart.com/article/yes-that-web-project-should-be-a-pwa#section1">базовых требований для PWA</a>:</p>
<p>Включение манифеста веб-приложения
Использование Service Worker
Добавление метаданных страницы</p>
<h2>Добавление файла манифеста</h2>
<p>Цитата от <a href="https://developers.google.com/web/fundamentals/web-app-manifest/">Google</a>:</p>
<blockquote>
<p>Манифест веб-приложения - JSON-файл, который сообщает браузеру о веб-приложении и о поведении этого приложения при “установке” на пользовательском мобильном устройстве или компьютере.</p>
</blockquote>
<p><a href="https://www.gatsbyjs.org/packages/gatsby-plugin-manifest/">Плагин манифеста</a> настраивает Gatsby для создания файла manifest.webmanifest для каждой сборки сайта.</p>
<h3>Использование gatsby-plugin-manifest</h3>
<ol>
<li>Установите плагин:</li>
</ol>
<pre><code class="language-shell">npm install --save gatsby-plugin-manifest
</code></pre>
<ol start="2">
<li>
<p>Добавьте значок приложения в <code>src/images/icon.png</code>. Если у вас нет значка, то для этого урока воспользуйтесь <a href="https://raw.githubusercontent.com/gatsbyjs/gatsby/master/docs/tutorial/part-eight/icon.png">этим</a>. Значок необходим для построения изображений манифеста. Для получения дополнительной информации обратитесь к документации по <a href="https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby-plugin-manifest/README.md"><code>gatsby-plugin-manifest</code></a></p>
</li>
<li>
<p>Добавьте плагин в массив <code>plugins</code> файла <code>gatsby-config.js</code>.</p>
</li>
</ol>
<pre><code class="language-javascript:title=gatsby-config.js">{
  plugins: [
    {
      resolve: `gatsby-plugin-manifest`,
      options: {
        name: `GatsbyJS`,
        short_name: `GatsbyJS`,
        start_url: `/`,
        background_color: `#6b37bf`,
        theme_color: `#6b37bf`,
        // Enables &quot;Add to Homescreen&quot; prompt and disables browser UI (including back button)
        // see https://developers.google.com/web/fundamentals/web-app-manifest/#display
        display: `standalone`,
        icon: `src/images/icon.png`, // This path is relative to the root of the site.
      },
    },
  ]
}
</code></pre>
<p>Это все, что вам необходимо, чтобы начать работу с добавлением веб-манифеста на Gatsby сайт. Дополнительно о плагине читайте <a href="https://www.gatsbyjs.org/packages/gatsby-plugin-manifest/?=gatsby-plugin-manifest#automatic-mode">справку</a>.</p>
<h2>Добавление офлайн поддержки</h2>
<p>Использование <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Worker</a> является еще одним требованием к веб-сайту, чтобы квалифицироваться как PWA. Service Worker работает в фоновом режиме и, в зависимости от подключения к сети, решает, обслуживать сетевое либо кэшированное содержимое, что обеспечивает бесперебойную управляемую автономную работу.</p>
<p><a href="https://www.gatsbyjs.org/packages/gatsby-plugin-offline/">gatsby-plugin-offline</a> делает сайт автономным и более устойчивым к плохим сетевым условиям, создавая Service Worker для сайта.</p>
<h3>Использование gatsby-plugin-offline</h3>
<ol>
<li>Установите плагин:</li>
</ol>
<pre><code class="language-shell">npm install --save gatsby-plugin-offline
</code></pre>
<ol start="2">
<li>Добавьте плагин в массив <code>plugins</code> файла <code>gatsby-config.js</code>.</li>
</ol>
<pre><code class="language-javascript:title=gatsby-config.js">{
  plugins: [
    {
      resolve: `gatsby-plugin-manifest`,
      options: {
        name: `GatsbyJS`,
        short_name: `GatsbyJS`,
        start_url: `/`,
        background_color: `#6b37bf`,
        theme_color: `#6b37bf`,
        // Enables &quot;Add to Homescreen&quot; prompt and disables browser UI (including back button)
        // see https://developers.google.com/web/fundamentals/web-app-manifest/#display
        display: `standalone`,
        icon: `src/images/icon.png`, // This path is relative to the root of the site.
      },
    },
    // highlight-next-line
    `gatsby-plugin-offline`,
  ]
}
</code></pre>
<p>Это все, что нужно, для работы с Service Worker в Gatsby.</p>
<p>Чтобы офлайн плагин кэшировал созданный <code>manifest.webmanifest</code> нужно, чтобы офлайн плагин указывался после плагина манифеста, .</p>
<h2>Добавление метаданных страницы</h2>
<p>Метаданные, такие как заголовок или описание, помогают поисковикам Google, Yandex и др. понять контент и решить, когда этот контент отображать в результатах поиска.</p>
<p><a href="https://github.com/nfl/react-helmet">React Helmet</a> - пакет, который содержит интерфейс React компонента, чтобы управлять <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/head">заголовком документа</a>.</p>
<p>Gatsby поддерживает <a href="https://www.gatsbyjs.org/packages/gatsby-plugin-react-helmet/">плагин react helmet</a> для отображения данных сервера, добавленных с помощью React Helmet. С помощью плагина атрибуты, добавленные в React Helmet, добавляются к статическим HTML-страницам, которые создает Gatsby.</p>
<h3>Использование React Helmet и gatsby-plugin-react-helmet</h3>
<ol>
<li>Установите оба пакета:</li>
</ol>
<pre><code class="language-shell">npm install --save gatsby-plugin-react-helmet react-helmet
</code></pre>
<ol start="2">
<li>Добавьте плагин в массив <code>plugins</code> файла <code>gatsby-config.js</code></li>
</ol>
<pre><code class="language-javascript:title=gatsby-config.js">{
  plugins: [
    {
      resolve: `gatsby-plugin-manifest`,
      options: {
        name: `GatsbyJS`,
        short_name: `GatsbyJS`,
        start_url: `/`,
        background_color: `#6b37bf`,
        theme_color: `#6b37bf`,
        // Enables &quot;Add to Homescreen&quot; prompt and disables browser UI (including back button)
        // see https://developers.google.com/web/fundamentals/web-app-manifest/#display
        display: `standalone`,
        icon: `src/images/icon.png`, // This path is relative to the root of the site.
      },
    },
    `gatsby-plugin-offline`,
    // highlight-next-line
    `gatsby-plugin-react-helmet`,
  ]
}
</code></pre>
<ol start="3">
<li>Используйте <code>React Helmet</code> на странице:</li>
</ol>
<pre><code class="language-jsx">import React from 'react';
import { Helmet } from 'react-helmet';

class Application extends React.Component {
  render() {
    return (
      &lt;div className=&quot;application&quot;&gt;
        {/* highlight-start */}
        &lt;Helmet&gt;
          &lt;meta charSet=&quot;utf-8&quot; /&gt;
          &lt;title&gt;My Title&lt;/title&gt;
          &lt;link rel=&quot;canonical&quot; href=&quot;http://mysite.com/example&quot; /&gt;
        &lt;/Helmet&gt;
        ...
        {/* highlight-end */}
      &lt;/div&gt;
    );
  }
}
</code></pre>
<p>Приведенный выше пример взят из <a href="https://github.com/nfl/react-helmet#example">React Helmet docs</a>.</p>
<h2>Дальнейшие действия</h2>
<h3>Официальная документация</h3>
<ul>
<li><a href="https://www.gatsbyjs.org/docs/">Официальная документация</a>: просмотрите официальную документацию
<ul>
<li><a href="https://www.gatsbyjs.org/docs/quick-start/">Быстрый старт</a>,</li>
<li><a href="https://www.gatsbyjs.org/docs/preparing-your-environment/">Подробные руководства</a>,</li>
<li><a href="https://www.gatsbyjs.org/docs/gatsby-link/">ссылки на API</a> и другое.</li>
</ul>
</li>
</ul>
<h3>Официальные Плагины</h3>
<ul>
<li><a href="https://github.com/gatsbyjs/gatsby/tree/master/packages">Официальные Плагины</a>: Полный список всех официальных плагинов, поддерживаемых Gatsby.</li>
</ul>
<h3>Официальные Стартеры</h3>
<ol>
<li><a href="https://github.com/gatsbyjs/gatsby-starter-default">Gatsby Стартер по умолчанию</a>: Начните проект с этого стандартного шаблона. Этот скелетный стартер поставляется с конфигурационными файлами Gatsby, которые вам могут понадобиться. <em><a href="https://gatsbyjs.github.io/gatsby-starter-default/">рабочий пример</a></em></li>
<li><a href="https://github.com/gatsbyjs/gatsby-starter-blog">Gatsby Стартер блога</a>: Gatsby стартер для создания классного и быстрого блога. <em><a href="https://gatsbyjs.github.io/gatsby-starter-blog/">рабочий пример</a></em></li>
<li><a href="https://github.com/gatsbyjs/gatsby-starter-hello-world">Gatsby Стартер &quot;Hello-World&quot;</a>: Gatsby стартер с голыми предметами первой необходимости, необходимыми для сайта Gatsby. <em><a href="https://gatsby-starter-hello-world-demo.netlify.com/">рабочий пример</a></em></li>
</ol>
<p><a href="https://www.gatsbyjs.org/tutorial/additional-tutorials/">Дополнительные руководства</a></p>
<p>Поделитесь в <a href="https://twitter.com/search?q=%23buildwithgatsby">Твитере</a> тем, что вы создали и <a href="https://twitter.com/gatsbyjs">@упомяните нас</a>!</p>
<p>Внесите вклад! Прогуляйтесь по <a href="https://github.com/gatsbyjs/gatsby/issues?q=is%3Aissue+is%3Aopen+label%3A%22help+wanted%22">открытым вопросам</a> репозитория Gatsby и <a href="https://www.gatsbyjs.org/contributing/how-to-contribute/">станьте вкладчиком</a>.</p>
<p>Узнайте, <a href="https://www.gatsbyjs.org/contributing/how-to-contribute/">“как внести вклад”</a> в документы для еще большего количества идей.</p>
<p>Для написания этой статьи использованы следующие материалы:</p>
<ul>
<li>https://www.gatsbyjs.org/tutorial/part-eight/</li>
</ul>

      </div>
    </div>
    <footer class="footer"> 
      <div class="footer__content content">
        <div class="footer__contacts" id="contacts"> <a class="footer__email-link" href="mailto:injashkin@gmail.com" title="Написать письмо">
            <svg class="icon icon__undefined" role="img" width="1em" height="1em">
              <use href="/sprite.svg#undefined"></use>
            </svg>
            <div class="footer__email">injashkin@gmail.com</div></a></div>
        <div class="footer__developer"> <a href="http://jinv.ru" target="_blank">Разработка сайта jinv.ru</a></div>
        <div class="footer__copyright-wrap">
          <div class="footer__copyright">jinv.ru © 2019 - 2022</div>
        </div>
      </div>
    </footer><!-- Yandex.Metrika counter -->
<script type="text/javascript">
  (function (m, e, t, r, i, k, a) {
    m[i] =
      m[i] ||
      function () {
        (m[i].a = m[i].a || []).push(arguments);
      };
    var z = null;
    m[i].l = 1 * new Date();
    for (var j = 0; j < document.scripts.length; j++) {
      if (document.scripts[j].src === r) {
        return;
      }
    }
    (k = e.createElement(t)),
      (a = e.getElementsByTagName(t)[0]),
      (k.async = 1),
      (k.src = r),
      a.parentNode.insertBefore(k, a);
  })(window, document, 'script', 'https://mc.yandex.ru/metrika/tag.js', 'ym');

  ym(60672532, 'init', {
    clickmap: true,
    trackLinks: true,
    accurateTrackBounce: true,
  });
</script>
<noscript
  ><div>
    <img
      src="https://mc.yandex.ru/watch/60672532"
      style="position: absolute; left: -9999px"
      alt=""
    /></div
></noscript>
<!-- /Yandex.Metrika counter -->

  </body>
</html>